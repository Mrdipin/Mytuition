<!DOCTYPE html>
<html lang="ne">
<head>
  <meta charset="UTF-8" />
  <title>MyTuition Dashboard</title>
  <style>
    /* FONT + BASE */
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      color: #333;
      transition: background 0.3s, color 0.3s;
      background: linear-gradient(-45deg, #fdfbfb, #ebedee, #c9d6ff, #e2e2e2);
      background-size: 400% 400%;
      animation: bodyGradient 15s ease infinite;
    }
    body.dark-mode {
      background: linear-gradient(to right, #1f1c2c, #928dab);
      color: #f0f0f0;
    }

    @keyframes bodyGradient {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    /* HEADER */
    header {
      background: linear-gradient(270deg, #2193b0, #6dd5ed, #2193b0);
      background-size: 600% 600%;
      animation: headerAnim 10s ease infinite;
      color: white;
      padding: 10px;
      text-align: center;
      font-size: 26px;
      font-weight: bold;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
      position: relative;
    }

    @keyframes headerAnim {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    #welcomeText {
      animation: rainbowText 3s infinite;
    }

    @keyframes rainbowText {
      0% { color: red; }
      20% { color: orange; }
      40% { color: yellow; }
      60% { color: green; }
      80% { color: blue; }
      100% { color: violet; }
    }

    /* BUTTONS */
    #logoutBtn, #langToggle, #darkModeToggle {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      padding: 6px 12px;
      font-size: 14px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: 0.3s;
      color: white;
    }

    #logoutBtn {
      right: 20px;
      background-color: #ff4e50;
    }

    #langToggle {
      left: 20px;
      background-color: #2ecc71;
    }

    #darkModeToggle {
      left: 80px;
      background-color: #f39c12;
      animation: colorPulse 4s infinite;
    }

    @keyframes colorPulse {
      0% { background-color: #f39c12; }
      50% { background-color: #e67e22; }
      100% { background-color: #f39c12; }
    }

    /* NAVIGATION */
    nav.topnav {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      background: linear-gradient(to right, #ff9966, #ff5e62);
      padding: 5px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.15);
    }

    nav.topnav a {
      text-decoration: none;
      color: white;
      font-weight: bold;
      padding: 10px 20px;
      margin: 5px;
      background: linear-gradient(45deg, #00c6ff, #0072ff);
      border-radius: 30px;
      transition: background 0.3s;
    }

    nav.topnav a:hover {
      background: linear-gradient(45deg, #7b4397, #dc2430);
    }

    main {
      padding: 30px;
      text-align: center;
    }

    .search-container {
      margin-top: 30px;
    }

    #searchInput {
      padding: 10px;
      width: 60%;
      max-width: 400px;
      border: 1px solid #ccc;
      border-radius: 8px;
      font-size: 16px;
    }

    #searchBtn {
      padding: 10px 20px;
      background: linear-gradient(90deg, #56ab2f, #a8e063);
      color: black;
      border: none;
      border-radius: 8px;
      margin-left: 10px;
      cursor: pointer;
      font-weight: bold;
    }

    #summaryBox {
      margin-top: 20px;
      padding: 20px;
      background: linear-gradient(to bottom, #ffe259, #ffa751);
      border-radius: 10px;
      max-width: 600px;
      margin-left: auto;
      margin-right: auto;
      box-shadow: 0 0 10px rgba(0,0,0,0.2);
      color: #2c3e50;
    }

    #summaryBox h3 {
      margin-bottom: 15px;
    }

    #searchResult > div {
      background: linear-gradient(45deg, #89f7fe, #66a6ff);
      color: #111;
      padding: 20px;
      margin: 20px auto;
      border-radius: 12px;
      max-width: 600px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
      text-align: left;
    }

    #searchResult button {
      background-color: #6a11cb;
      background-image: linear-gradient(315deg, #6a11cb 0%, #2575fc 74%);
      border: none;
      color: white;
      padding: 6px 14px;
      margin-right: 10px;
      border-radius: 6px;
      cursor: pointer;
    }

    /* FOOTER MARQUEE */
    .footer-marquee {
      width: 100%;
      position: fixed;
      bottom: 0;
      left: 0;
      padding: 14px 0;
      background: linear-gradient(270deg, #ff6a00, #ee0979, #00c9ff, #92fe9d);
      background-size: 600% 600%;
      animation: bgColorFlow 10s ease infinite;
      overflow: hidden;
      z-index: 999;
    }

    .footer-marquee span {
      display: inline-block;
      padding-left: 100%;
      animation: scrollText 15s linear infinite;
      white-space: nowrap;
      font-size: 18px;
      font-weight: bold;
      color: #fff;
      text-shadow: 1px 1px 2px #000;
    }

    @keyframes scrollText {
      0% { transform: translateX(0%); }
      100% { transform: translateX(-100%); }
    }

    @keyframes bgColorFlow {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }
  </style>
</head>

<body>
  <header>
    <button id="langToggle">EN</button>
    <button id="darkModeToggle">ЁЯМЩ</button>
    <span id="welcomeText">WELCOM~DIPINSIR</span>
    <button id="logoutBtn">Logout</button>
  </header>

  <nav class="topnav">
    <a href="new-student.html" id="navStudent">ЁЯСитАНЁЯОУ рд╡рд┐рджреНрдпрд╛рд░реНрдереА рд╡реНрдпрд╡рд╕реНрдерд╛рдкрди</a>
    <a href="attendance.html" id="navAttendance">ЁЯУЕрд╣рд╛рдЬрд┐рд░реА рд╡реНрдпрд╡рд╕реНрдерд╛рдкрди рдкреНрд░рдгрд╛рд▓реА</a>
    <a href="fee.html" id="navFee">ЁЯТ░ рд╢реБрд▓реНрдХ рд╡реНрдпрд╡рд╕реНрдерд╛рдкрди рдкреНрд░рдгрд╛рд▓реА</a>
    <a href="notification.html" id="navNotification">ЁЯФФ рд╕реВрдЪрдирд╛</a>
  </nav>

  <main>
    <h2 id="dashboardTitle">рдбреНрдпрд╛рд╕рдмреЛрд░реНрдб рд╡рд┐рд╡рд░рдг</h2>
    <div class="search-container">
      <input type="text" id="searchInput" placeholder="ЁЯФН рд╡рд┐рджреНрдпрд╛рд░реНрдереАрдХреЛ рдирд╛рдо рдЦреЛрдЬреНрдиреБрд╣реЛрд╕реН" />
      <button id="searchBtn" onclick="handleSearch()">рдЦреЛрдЬреНрдиреБрд╣реЛрд╕реН</button>
    </div>

    <div id="summaryBox">
      <h3 id="summaryTitle">ЁЯУК рд╕рд╛рд░рд╛рдВрд╢</h3>
      <p id="totalStudents">ЁЯСитАНЁЯОУ рдХреБрд▓ рд╡рд┐рджреНрдпрд╛рд░реНрдереА: ...</p>
      <p id="presentToday">тЬЕ рдЖрдЬрдХреЛ рдЙрдкрд╕реНрдерд┐рддрд┐: ...</p>
      <p id="unpaidFees">ЁЯТ╕ рдмрд╛рдХреА рд╢реБрд▓реНрдХ: ...</p>
    </div>

    <div id="searchResult"></div>
  </main>

  <div class="footer-marquee">
    <span>ЁЯСЛ рд╕реНрд╡рд╛рдЧрдд рдЫ ~ WELCOM~DIPINSIR ~ MyTuition Dashboard рдорд╛ ! ЁЯОУЁЯУЪ</span>
  </div>
<script src="https://cdn.jsdelivr.net/npm/emailjs-com@2/dist/email.min.js"></script>
  <script>
    (function(){
      emailjs.init("fmUaXrZdVTOuNPqLU"); // ЁЯСЙ рдпрд╣рд╛рдБ рдЖрдлреНрдиреЛ EmailJS public key рд░рд╛рдЦреНрдиреВ
    })();
  </script>
  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/10.5.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.5.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.5.0/firebase-auth-compat.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyCfW5RGnApAZLhsjVkkphsdG9moIj44ugU",
      authDomain: "mytuition-e48a3.firebaseapp.com",
      projectId: "mytuition-e48a3",
      storageBucket: "mytuition-e48a3.appspot.com",
      messagingSenderId: "278641988463",
      appId: "1:278641988463:web:e43309b072c7287a968e9a"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    firebase.auth().onAuthStateChanged(user => {
      if (!user) window.location.href = "login.html";
    });

    document.getElementById('logoutBtn').addEventListener('click', () => {
      firebase.auth().signOut().then(() => {
        alert("Logout рд╕рдлрд▓ рднрдпреЛред");
        window.location.href = "login.html";
      }).catch((error) => {
        alert("Logout рдЧрд░реНрджрд╛ рд╕рдорд╕реНрдпрд╛ рдЖрдпреЛ: " + error.message);
      });
    });

    const darkModeToggle = document.getElementById('darkModeToggle');
    if (localStorage.getItem('darkMode') === 'enabled') {
      document.body.classList.add('dark-mode');
      darkModeToggle.textContent = 'ЁЯМЮ';
    }
    darkModeToggle.addEventListener('click', () => {
      document.body.classList.toggle('dark-mode');
      const isDark = document.body.classList.contains('dark-mode');
      darkModeToggle.textContent = isDark ? 'ЁЯМЮ' : 'ЁЯМЩ';
      localStorage.setItem('darkMode', isDark ? 'enabled' : 'disabled');
    });

    const summaryText = {
      NE: {
        summary: 'ЁЯУК рд╕рд╛рд░рд╛рдВрд╢',
        total: 'ЁЯСитАНЁЯОУ рдХреБрд▓ рд╡рд┐рджреНрдпрд╛рд░реНрдереА: ',
        present: 'тЬЕ рдЖрдЬрдХреЛ рдЙрдкрд╕реНрдерд┐рддрд┐: ',
        unpaid: 'ЁЯТ╕ рдмрд╛рдХреА рд╢реБрд▓реНрдХ: ',
      },
      EN: {
        summary: 'ЁЯУК Summary',
        total: 'ЁЯСитАНЁЯОУ Total Students: ',
        present: 'тЬЕ Present Today: ',
        unpaid: 'ЁЯТ╕ Unpaid Fees: ',
      }
    };

    const langToggleBtn = document.getElementById("langToggle");
    let currentLang = localStorage.getItem('language') || 'NE';

    function updateLanguage(lang) {
      const text = summaryText[lang];
      document.getElementById('summaryTitle').innerText = text.summary;
      document.getElementById('dashboardTitle').innerText = (lang === 'EN') ? "Dashboard Overview" : "рдбреНрдпрд╛рд╕рдмреЛрд░реНрдб рд╡рд┐рд╡рд░рдг";
      document.getElementById('searchInput').placeholder = (lang === 'EN') ? "ЁЯФН Search student by name" : "ЁЯФН рд╡рд┐рджреНрдпрд╛рд░реНрдереАрдХреЛ рдирд╛рдо рдЦреЛрдЬреНрдиреБрд╣реЛрд╕реН";
      document.getElementById('searchBtn').innerText = (lang === 'EN') ? "Search" : "рдЦреЛрдЬреНрдиреБрд╣реЛрд╕реН";
      document.getElementById('navStudent').innerText = (lang === 'EN') ? "ЁЯСитАНЁЯОУ Student Management" : "ЁЯСитАНЁЯОУ рд╡рд┐рджреНрдпрд╛рд░реНрдереА рд╡реНрдпрд╡рд╕реНрдерд╛рдкрди";
      document.getElementById('navAttendance').innerText = (lang === 'EN') ? "ЁЯУЕ Attendance System" : "ЁЯУЕрд╣рд╛рдЬрд┐рд░реА рд╡реНрдпрд╡рд╕реНрдерд╛рдкрди рдкреНрд░рдгрд╛рд▓реА";
      document.getElementById('navFee').innerText = (lang === 'EN') ? "ЁЯТ░ Fee Management" : "ЁЯТ░ рд╢реБрд▓реНрдХ рд╡реНрдпрд╡рд╕реНрдерд╛рдкрди рдкреНрд░рдгрд╛рд▓реА";
      document.getElementById('navNotification').innerText = (lang === 'EN') ? "ЁЯФФ Notifications" : "ЁЯФФ рд╕реВрдЪрдирд╛";
      langToggleBtn.innerText = (lang === 'EN') ? "NE" : "EN";
      localStorage.setItem('language', lang);
      loadSummary();
    }

    langToggleBtn.addEventListener('click', () => {
      currentLang = (currentLang === 'NE') ? 'EN' : 'NE';
      updateLanguage(currentLang);
    });
    updateLanguage(currentLang);

    function loadSummary() {
      const text = summaryText[currentLang];
      db.collection("students").get().then(snapshot => {
        document.getElementById("totalStudents").innerText = text.total + snapshot.size;

        const today = new Date().toISOString().split('T')[0];
        db.collection("attendance").where("date", "==", today).where("status", "==", "Present").get()
          .then(att => {
            document.getElementById("presentToday").innerText = text.present + att.size;
          }).catch(() => {
            document.getElementById("presentToday").innerText = text.present + "N/A";
          });

        db.collection("fee").where("status", "==", "Unpaid").get()
          .then(unpaid => {
            document.getElementById("unpaidFees").innerText = text.unpaid + unpaid.size;
          }).catch(() => {
            document.getElementById("unpaidFees").innerText = text.unpaid + "N/A";
          });
      }).catch(err => {
        document.getElementById("totalStudents").innerText = "рддреНрд░реБрдЯрд┐: " + err.message;
      });
    }

    function handleSearch() {
      const query = document.getElementById("searchInput").value.trim().toLowerCase();
      const resultDiv = document.getElementById("searchResult");
      resultDiv.innerHTML = "";

      if (!query) {
        alert(currentLang === 'EN' ? "Please enter student name." : "рдХреГрдкрдпрд╛ рд╡рд┐рджреНрдпрд╛рд░реНрдереАрдХреЛ рдирд╛рдо рд▓реЗрдЦреНрдиреБрд╣реЛрд╕реНред");
        return;
      }

      db.collection("students").get().then(snapshot => {
        let found = false;
        snapshot.forEach(doc => {
          const data = doc.data();
          const name = (data.fullName || "").toLowerCase();
          if (name.includes(query)) {
            found = true;
            sendNotification("ЁЯФН рд╡рд┐рджреНрдпрд╛рд░реНрдереА рдЦреЛрдЬрд┐рдпреЛ", `рддрдкрд╛рдИрдВрд▓реЗ '${data.fullName}' рдирд╛рдордХреЛ рд╡рд┐рджреНрдпрд╛рд░реНрдереА рдЦреЛрдЬреНрдиреБрднрдпреЛред`);

            const cardId = `studentCard_${doc.id}`;
            resultDiv.innerHTML += `
              <div id="${cardId}">
                <h3>ЁЯСд ${data.fullName || "рдирд╛рдо рдЫреИрди"}</h3>
                <p>ЁЯУЮ рдлреЛрди: ${data.phone || "N/A"}</p>
                <p>ЁЯПлрдареЗрдЧрд╛рдирд╛: ${data.grade || "N/A"}</p>
                <p>ЁЯТ╕ рдорд╛рд╕рд┐рдХ рд╢реБрд▓реНрдХ: ${data.monthlyFee || "N/A"}</p>
                <p>ЁЯУЕ : ${data.dob || "N/A"}</p>
                <p>ЁЯУМ рд╕реНрдерд┐рддрд┐: ${data.status || "N/A"}</p>
                ${data.photoURL ? `<img src="${data.photoURL}" alt="рд╡рд┐рджреНрдпрд╛рд░реНрдереА рдлреЛрдЯреЛ" style="width:100px;border-radius:10px;margin-top:10px;" />` : ''}
                <div style="margin-top: 20px;">
                  <button onclick="editStudent('${doc.id}')">тЬПя╕П ${currentLang === 'EN' ? 'Edit' : 'рд╕рдореНрдкрд╛рджрди'}</button>
                  <button onclick="printCard('${cardId}')">ЁЯЦия╕П ${currentLang === 'EN' ? 'Print' : 'рдкреНрд░рд┐рдиреНрдЯ'}</button>
                </div>
              </div>
            `;
          }
        });
        if (!found) {
          resultDiv.innerHTML = `<p style="color:red;">${currentLang === 'EN' ? 'тЭМ Student not found.' : 'тЭМ рд╡рд┐рджреНрдпрд╛рд░реНрдереА рднреЗрдЯрд┐рдПрдиред'}</p>`;
        }
      }).catch(err => {
        resultDiv.innerHTML = `<p style="color:red;">ЁЯФе ${currentLang === 'EN' ? 'Search failed:' : 'рдЦреЛрдЬреНрди рд╕рдХрд┐рдПрди:'} ${err.message}</p>`;
      });
    }

    function sendNotification(title, message) {
      db.collection("notifications").add({
        title: title,
        message: message,
        timestamp: firebase.firestore.FieldValue.serverTimestamp()
      });
      emailjs.send("service_3as2g6b", "template_qw5xoeh", {
        to_email: "dipinkumarmahara353@gmail.com",
        subject: title,
        message: message
      });
    }

    function printCard(cardId) {
      const content = document.getElementById(cardId).innerHTML;
      const win = window.open('', '', 'height=700,width=900');
      win.document.write('<html><head><title>рд╡рд┐рджреНрдпрд╛рд░реНрдереА рд╡рд┐рд╡рд░рдг</title>');
      win.document.write('<style>body{font-family:Arial;padding:30px;} h3{font-size:24px;} p{font-size:18px;} img{margin-top:10px;}</style>');
      win.document.write('</head><body>');
      win.document.write(content);
      win.document.close();
      win.print();
    }

    function editStudent(studentId) {
      window.location.href = `edit-student.html?id=${studentId}`;
    }
  </script>
</body>
</html>(